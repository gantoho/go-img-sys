openapi: 3.0.3
info:
  title: go-img-sys API (generated from router & handlers)
  version: "1.0.0"
  description: Autogenerated OpenAPI from internal/router and handler implementations. 精确映射项目实际路由。
servers:
  - url: http://localhost:3128

paths:
  /api/v1/health:
    get:
      summary: 健康检查
      responses:
        '200':
          description: 服务状态
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/images:
    get:
      summary: 列出所有图片 (URL 列表)
      responses:
        '200':
          description: 图片列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageData'

  /api/v1/images/metadata:
    get:
      summary: 列出所有图片并包含元数据
      responses:
        '200':
          description: 图片元数据数组
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ImageMetaData'

  /api/v1/images/paginated:
    get:
      summary: 分页获取图片（含元数据）
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: page_size
          schema: { type: integer }
      responses:
        '200':
          description: 分页结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedImageData'

  /api/v1/images/search:
    get:
      summary: 搜索与过滤图片
      parameters:
        - in: query
          name: filename
          schema: { type: string }
        - in: query
          name: min_size
          schema: { type: integer }
        - in: query
          name: max_size
          schema: { type: integer }
        - in: query
          name: type
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: page_size
          schema: { type: integer }
      responses:
        '200':
          description: 搜索结果（分页样式）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedImageData'

  /api/v1/images/random:
    get:
      summary: 获取单个随机图片（返回文件名，文本）
      responses:
        '200':
          description: 随机图片文件名
          content:
            text/plain:
              schema:
                type: string

  /api/v1/images/random/:number:
    get:
      summary: 获取 N 张随机图片（路径参数名为 number）
      parameters:
        - in: path
          name: number
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: 多张随机图片 URL 列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  data:
                    type: array
                    items:
                      type: string

  /api/v1/images/upload:
    post:
      summary: 上传图片（multipart; 受 API Key 保护）
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 上传结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResult'

  /api/v1/images/{filename}:
    delete:
      summary: 删除单个图片（受 API Key 保护）
      parameters:
        - in: path
          name: filename
          required: true
          schema: { type: string }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 删除结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/images/delete:
    post:
      summary: 批量删除图片（受 API Key 保护）
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filenames:
                  type: array
                  items: { type: string }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 批量删除结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchDeleteResult'

  /api/v1/admin/api-keys:
    post:
      summary: 创建 API Key (管理员，受保护)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expire_days: { type: integer }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 创建成功，返回明文 key
          content:
            application/json:
              schema:
                type: object
    get:
      summary: 列出 API Keys (管理员)
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 密钥列表
          content:
            application/json:
              schema:
                type: object
    delete:
      summary: 撤销 API Key (管理员)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                api_key: { type: string }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 撤销结果
          content:
            application/json:
              schema:
                type: object

  /api/v1/util/statistics:
    get:
      summary: 获取统计信息
      responses:
        '200':
          description: 统计数据
          content:
            application/json:
              schema:
                type: object

  /api/v1/util/disk-usage:
    get:
      summary: 获取磁盘使用信息
      responses:
        '200':
          description: 磁盘使用
          content:
            application/json:
              schema:
                type: object

  /api/v1/util/export:
    post:
      summary: 导出指定文件为 ZIP (受保护)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filenames:
                  type: array
                  items: { type: string }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 导出成功
          content:
            application/json:
              schema:
                type: object

  /api/v1/util/export-all:
    post:
      summary: 导出所有文件为 ZIP (受保护)
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 导出成功 (所有文件)
          content:
            application/json:
              schema:
                type: object

  /api/v1/util/cleanup:
    post:
      summary: 执行清理操作 (受保护)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 清理结果
          content:
            application/json:
              schema:
                type: object

  /api/v1/util/generate-thumbnails:
    post:
      summary: 触发缩略图生成（受保护，使用 query 参数 filenames）
      parameters:
        - in: query
          name: filenames
          schema: { type: string }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 任务已触发
          content:
            application/json:
              schema:
                type: object

  /f/{filename}:
    get:
      summary: 直接访问静态图片文件
      parameters:
        - in: path
          name: filename
          required: true
          schema: { type: string }
      responses:
        '200':
          description: 图片二进制
          content:
            image/*:
              schema:
                type: string
                format: binary

  /v1/:
    get:
      summary: 兼容旧版健康检查
      responses:
        '200':
          description: 健康检查
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /v1/all:
    get:
      summary: 旧版获取所有图片（兼容）
      responses:
        '200':
          description: 图片列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageData'

  /v1/get/{number}:
    get:
      summary: 旧版获取 N 张随机图片（兼容）
      parameters:
        - in: path
          name: number
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: 多张随机图片 URL 列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  data:
                    type: array
                    items: { type: string }

  /v1/bgimg:
    get:
      summary: 旧版随机图片（返回文本）
      responses:
        '200':
          description: 随机图片文件名
          content:
            text/plain:
              schema:
                type: string

  /v1/upload:
    post:
      summary: 旧版上传接口（兼容，受保护）
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items: { type: string, format: binary }
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: 上传结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResult'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
  schemas:
    SuccessResponse:
      type: object
      properties:
        code: { type: integer }
        message: { type: string }
        data: { type: object }
    ImageData:
      type: object
      properties:
        total: { type: integer }
        data:
          type: array
          items: { type: string }
    ImageMetaData:
      type: object
      properties:
        filename: { type: string }
        url: { type: string }
        size: { type: integer }
        size_str: { type: string }
        mime_type: { type: string }
        mod_time: { type: integer }
    PaginatedImageData:
      type: object
      properties:
        total: { type: integer }
        page: { type: integer }
        page_size: { type: integer }
        pages: { type: integer }
        data:
          type: array
          items: { $ref: '#/components/schemas/ImageMetaData' }
    UploadResult:
      type: object
      properties:
        message: { type: string }
        total_files: { type: integer }
        total_uploaded: { type: integer }
        uploaded:
          type: array
          items:
            type: object
            properties:
              index: { type: integer }
              filename: { type: string }
              size: { type: integer }
              url: { type: string }
              progress: { type: integer }
    BatchDeleteResult:
      type: object
      properties:
        total_deleted: { type: integer }
        deleted:
          type: array
          items: { type: string }
        total_failed: { type: integer }
        failed:
          type: array
          items:
            type: object
            properties:
              filename: { type: string }
              error: { type: string }

